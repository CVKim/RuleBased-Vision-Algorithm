
# Rule-Based Vision Algorithm Platform

## ğŸ“‹ Overview

This project is a scalable **C++ based Computer Vision Platform** designed for industrial inspection tasks. It utilizes **OpenCV** and efficient rule-based logic to perform high-precision image analysis.

The platform is architected to be **modular**, allowing easy integration of various inspection algorithms (e.g., Contour Inspection, Barcode/Template Matching) into a single execution pipeline.

---

## ğŸ—ï¸ Project Structure

The project follows a modular design pattern. Specific algorithm logic is grouped into the `Algorithm` folder to separate it from the main controller and shared utilities.

```text
RulebaseAlgorithm/
â”œâ”€â”€ ğŸ“‚ Algorithm/                # Specific Inspection Logic Modules
â”‚   â”œâ”€â”€ KBRulebase.h            # [Module 1] KB Contour Inspection Header
â”‚   â”œâ”€â”€ KBRulebase.cpp          # [Module 1] KB Contour Inspection Implementation
â”‚   â”œâ”€â”€ BarcodeRulebase.h       # [Module 2] Barcode/Template Inspection Header
â”‚   â””â”€â”€ BarcodeRulebase.cpp     # [Module 2] Barcode/Template Inspection Implementation
â”‚
â”œâ”€â”€ ğŸ“‚ Header Files/             
â”‚   â””â”€â”€ CommonUtils.h           # Shared Utilities (Logger, Unicode I/O, Spline, Macros)
â”‚
â”œâ”€â”€ main.cpp                    # Main Entry Point (Controller)
â””â”€â”€ README.md                   # Project Documentation

```

---

## ğŸš€ Key Features & Modules

### 1. KB Inspection (Contour & Linearity)

* **Goal:** Detects curvature and tilt defects by tracking the product's contour.
* **Core Logic:**
* **Cost Map & DP:** Finds the optimal path using Dynamic Programming on a cost map.
* **Spline Interpolation:** Smoothes the detected path using Cubic Splines (`tk::spline`).
* **PCA Analysis:** Calculates Linearity Deviation and Tilt Angle using Principal Component Analysis.



### 2. Barcode Inspection (Golden Template Matching)

* **Goal:** Detects defects (rips, missing parts) by comparing with a "Golden Template".
* **Core Logic:**
* **Golden Template:** Loads reference mask (`.bmp`) and coordinate data (`.json`).
* **Perspective Transform:** Aligns the target image using 4-point ROI alignment.
* **Defect Extraction:** Uses image subtraction and morphological filtering to find significant defects.



---

## âš™ï¸ Configuration & Troubleshooting

### âš ï¸ Compiling Issues: `min` / `max` Macro Conflict

In Windows (Visual Studio) environments, the `<windows.h>` header defines `min` and `max` macros, which conflict with C++ standard functions (`std::min`, `std::max`).

**Solution:**
Ensure that **`NOMINMAX`** is defined at the very top of `CommonUtils.h` before including any Windows headers.

```cpp
// CommonUtils.h
#pragma once
#define NOMINMAX  // <--- IMPORTANT: Prevents macro conflict
#include <windows.h>
// ...

```

---

## ğŸ’» Usage

### 1. Main Entry Point (`main.cpp`)

You can select which algorithm to run by calling the appropriate entry function in `main.cpp`.

```cpp
int main() {
    // 1. Run KB Contour Inspection
    // Run_KB_Rulebase_Algorithm(L"path/to/kb_images");

    // 2. Run Barcode Template Inspection
    Run_Barcode_Rulebase_Algorithm(L"path/to/barcode_images");

    return 0;
}

```

### 2. Input Requirements (Barcode Mode)

For the Barcode algorithm to work, the input directory **must** contain the reference files generated by the Python registration script:

* `golden_template.bmp`: The reference binary mask.
* `golden_points.json`: The 4-point coordinate data for alignment.
